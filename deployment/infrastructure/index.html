
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../preparation/">
      
      
        <link rel="next" href="../configuration/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.6">
    
    
      
        <title>Infrastructure - Orthweb - Orthanc Solution on AWS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Orthweb - Orthanc Solution on AWS" class="md-header__button md-logo" aria-label="Orthweb - Orthanc Solution on AWS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Orthweb - Orthanc Solution on AWS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Infrastructure
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/digihunch/orthweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    digihunch/orthweb
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Orthweb - Orthanc Solution on AWS" class="md-nav__button md-logo" aria-label="Orthweb - Orthanc Solution on AWS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Orthweb - Orthanc Solution on AWS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/digihunch/orthweb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    digihunch/orthweb
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/configmgmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Traffic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/deviceconnectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Device Connectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preparation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-init" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjust-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-apply" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Apply
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-output" class="md-nav__link">
    <span class="md-ellipsis">
      Review Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-state" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform State
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-estimate" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Estimate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    <span class="md-ellipsis">
      Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean up
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Validation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../validation/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../validation/advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../validation/additional/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-init" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Init
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjust-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Adjust Variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-apply" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform Apply
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-output" class="md-nav__link">
    <span class="md-ellipsis">
      Review Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform-state" class="md-nav__link">
    <span class="md-ellipsis">
      Terraform State
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-estimate" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Estimate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    <span class="md-ellipsis">
      Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean up
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Infrastructure</h1>

<h2 id="overview">Overview</h2>
<p>Since we execute Terraform commands locally to drive the deployment, we also store Terraform states locally. Advanced Terraform users may choose to managed Terraform platform such as HCP Terraform(previously known as Terraform Cloud) which is beyond the scope of this document. </p>
<p>Now we can start deploying Orthanc. From your command terminal, go to the <a href="https://github.com/digihunch/orthweb/tree/main/terraform"><code>terraform</code></a> directory, and run <code>terraform</code> commands from this directory.</p>
<h2 id="terraform-init">Terraform Init</h2>
<p>First, initialize terraform template with this command:
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>init
</code></pre></div>
The command initializes Terraform template, including pulling external modules and download providers. Successful initialization should report the following line: </p>
<div class="highlight"><pre><span></span><code>Terraform has been successfully initialized!
</code></pre></div>
<p>After initialization, terraform creates <code>.terraform</code> directory to store the pulled modules and providers.</p>
<h2 id="adjust-variables">Adjust Variables</h2>
<p>There are several ways to declare <a href="https://developer.hashicorp.com/terraform/language/values/variables">input variable</a> in Terraform. In this solution, we use <code>terraform.tfvars</code> file in the terraform working directory. The <a href="https://github.com/digihunch/orthweb/blob/main/terraform/terraform.tfvars">file</a> is loaded with functional input variables. Users should review the variables and adjust accordingly. Here is a sample of the <code>terraform.tfvars</code> file:</p>
<div class="highlight"><pre><span></span><code>ec2_config = {
  InstanceType  = &quot;t3.medium&quot;
  PublicKeyData = null
  PublicKeyPath = &quot;~/.ssh/id_rsa.pub&quot;
}
network_config = {
  vpc_cidr              = &quot;172.17.0.0/16&quot;
  dcm_cli_cidrs         = [&quot;0.0.0.0/0&quot;]
  web_cli_cidrs         = [&quot;0.0.0.0/0&quot;]
  az_count              = 2
  public_subnet_pfxlen  = 24
  private_subnet_pfxlen = 22
  interface_endpoints   = []
  vpn_client_cidr       = &quot;&quot; # 192.168.0.0/22
  vpn_cert_cn_suffix    = &quot;vpn.digihunch.com&quot;
  vpn_cert_valid_days   = 3650
}
provider_tags = {
  environment = &quot;dev&quot;
  owner       = &quot;admin@digihunch.com&quot;
}
deployment_options = {
  ConfigRepo     = &quot;https://github.com/digihunchinc/orthanc-config.git&quot;
  CWLogRetention = 3
  EnableCWLog    = false
  SiteName       = null
  InitCommand    = &quot;pwd &amp;&amp; echo Custom Command &amp;&amp; make aws&quot;
}
</code></pre></div>
<p>To determin the variable values, some decisions to make are:</p>
<ul>
<li>Value of provider tag and site name </li>
<li>Size of EC2 instance and public key</li>
<li>Number of availability zones, CIDR for the VPC and subnet sizing</li>
<li>CIDR blocks of the web and dicom client to whitelist</li>
<li>Whether or not to ship docker log to Cloud Watch and retention period</li>
</ul>
<p>In most cases, users at least need to update the provider tag and site name. Read the full document for input variables <a href="https://github.com/digihunch/orthweb/blob/main/terraform/README.md">here</a>.</p>
<h2 id="terraform-plan">Terraform Plan</h2>
<p>We plan the deployment with command:</p>
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>plan
</code></pre></div>
<p>The is command projects the changes that will be applied to AWS. It will print out the resources and what changes Terraform will make.</p>
<p>If you're running this command for the first time, Terraform will flag all resources as to be created. If you're running the command with a change of Terraform template, it will only mark the prospective changes. </p>
<p>At the end of the result, it will summarize the actions to take, for example:
<div class="highlight"><pre><span></span><code>Plan: 54 to add, 0 to change, 0 to destroy.
</code></pre></div>
If the plan fails, check the code and state file. The number of resources to add depends on the specific input variables and whether the solution has been previously deployed.</p>
<h2 id="terraform-apply">Terraform Apply</h2>
<p>If the plan looks good, we can apply the deployment plan:
<div class="highlight"><pre><span></span><code>terraform apply
</code></pre></div>
Then, you need to say <code>yes</code> to the prompt. Terraform kicks off the deployment.  </p>
<p>During deployment, Terraform provider interacts with your AWS account to provision the resources. Some critical resources takes much longer than others due to sheer size. For example, the database alone takes 15 minutes. The EC2 instances also takes a few minutes because of the bootstrapping process that configures Orthanc application. The entire deployment process can take as long as 30 minutes. To fask track the progress, you parrallelize the deployment with flags such as <code>-parallelism=3</code>. </p>
<h2 id="review-output">Review Output</h2>
<p>Upon successful deployment, the screen should print out four entries. They are explained in the table below:</p>
<table>
<thead>
<tr>
<th>key</th>
<th>example value</th>
<th>protocol</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>server_dns</strong></td>
<td>ec2-15-156-192-145.ca-central-1.compute.amazonaws.com, ec2-99-79-73-88.ca-central-1.compute.amazonaws.com (HTTPS and DICOM TLS)</td>
<td>HTTPS/DICOM-TLS</td>
<td>Business traffic: HTTPS on port 443 and DICOM-TLS on port 11112. Reachable from the Internet.</td>
</tr>
<tr>
<td><strong>host_info</strong></td>
<td>Primary:i-02d92d2c1c046ea62    Secondary:i-076b93808575da71e</td>
<td>SSH</td>
<td>For management traffic.</td>
</tr>
<tr>
<td><strong>s3_bucket</strong></td>
<td>wealthy-lemur-orthbucket.s3.amazonaws.com</td>
<td>HTTPS-S3</td>
<td>For orthanc to store and fetch images. Access is restricted.</td>
</tr>
<tr>
<td><strong>db_endpoint</strong></td>
<td>wealthy-lemur-orthancpostgres.cqfpmkrutlau.us-east-1.rds.amazonaws.com:5432</td>
<td>TLS-POSTGRESQL</td>
<td>For orthanc to index data. Access is restricted.</td>
</tr>
</tbody>
</table>
<p>Once the screen prints the output, the EC2 instances may still take a couple extra minutes in the background to finish  configuring Orthanc. We can start validation as per the steps outlined in the next section. </p>
<p>If applicable, deploy the custom application traffic management</p>
<h2 id="terraform-state">Terraform State</h2>
<p>Terraform keeps a local file <code>terraform.tfstate</code> for the last known state of the deployed resources, known as the state file. This file is critical for the ongoing maintanance of the deployed resources.</p>
<p>Ad hoc changes to the resources created by Terraform are not registered in the state file. These changes, often referred to as configuration drift, are very likely to cause issues when the Terraform managed resources are updated or deleted. In general, manual changes to Terraform managed resources should be avoided. Changes should be first registered in the Terraform template and applied via the <code>terraform apply</code> command.</p>
<h2 id="cost-estimate">Cost Estimate</h2>
<p>Below is a per-day estimate of cost (in USD) of the infrastructure based on default configuration. </p>
<table>
<thead>
<tr>
<th style="text-align: left;">AWS Service</th>
<th style="text-align: center;">Standing Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Relational Database</td>
<td style="text-align: center;">$3.6</td>
</tr>
<tr>
<td style="text-align: left;">EC2-Instances</td>
<td style="text-align: center;">$2.2</td>
</tr>
<tr>
<td style="text-align: left;">VPC</td>
<td style="text-align: center;">$0.6</td>
</tr>
<tr>
<td style="text-align: left;">Key Management Service</td>
<td style="text-align: center;">$0.13</td>
</tr>
<tr>
<td style="text-align: left;">EC2-Other</td>
<td style="text-align: center;">$0.12</td>
</tr>
<tr>
<td style="text-align: left;">Secrets Manager</td>
<td style="text-align: center;">$0.12</td>
</tr>
<tr>
<td style="text-align: left;">S3</td>
<td style="text-align: center;">$0.13</td>
</tr>
<tr>
<td style="text-align: left;"><b>Total daily cost</b></td>
<td style="text-align: center;"><b>$7</b></td>
</tr>
</tbody>
</table>
<p>Note, the numbers does not include data processing charges such as images stored to and retrieved from S3, or data moved in and out of the Internet Gateway, etc. The numbers also have free-tier usage factored in. Users are advised to run the solution with everyday usage to get a more realistic ballpark of daily cost. AWS has a comprehensive <a href="https://calculator.aws/#/">pricing calculator</a> and <a href="https://aws.amazon.com/savingsplans/">saving plans</a> available.</p>
<h2 id="logs">Logs</h2>
<p>To view container logs from EC2 instance, use docker compose log command:
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>-f
</code></pre></div>
If cloud watch log is enabled, the docker daemon configuration file is automatically configured on EC2 instances to ship logs to cloud watch log groups with the configured retention window. </p>
<h2 id="clean-up">Clean up</h2>
<p>After the validation is completed, it is important to remember this step to stop incurring on-going cost.</p>
<p>You can delete all the resources with <code>destroy</code> command:
<div class="highlight"><pre><span></span><code>terraform destroy
</code></pre></div>
The command should report that all resources are deleted.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>